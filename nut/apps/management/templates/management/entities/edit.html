{% extends 'management/management_base.html' %}
{% load i18n %}
{% load guoku %}

{% block content %}
    <h1 class="page-header">{{ entity.title }}</h1>
    <div class="row placeholders" id="images">
        {% for index, image in entity.images|enumerate_list %}
            <div class="col-xs-6 col-sm-3 placeholder">
                <img class="img-responsive img-thumbnail" alt="{{ entity.title }}" src="{{ image|resize:'240' }}" width="240" height="240">
{#                {% if index != 0 %}#}
                <span class="text-muted">
{#                    <a class="btn btn-link" href="{% url 'management_remove_entity_image' entity.id %}">{% trans 'remove' %}</a>#}
                    <a class="btn btn-link" href="{% url 'management_remove_entity_image' entity.id %}" data-image="{{ image }}">{% trans 'remove' %}</a>
                </span>
{#                {% endif %}#}
            </div>
        {% endfor %}
    </div>
    {% if entity.has_top_note %}
    <div class="row">
        <div class="alert alert-info alert-dismissable" role="alert">
                <button type="button" class="close" data-dismiss="alert">
                    <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                </button>
                <strong>{% trans 'note' %}!!!</strong>
                有置顶点评
        </div>
    </div>
    {% endif %}

    <div class="row" style="padding-bottom: 24px;">
        <a href="{% url 'management_note_create' entity.pk %}" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#EntityNoteModal">{% trans 'add note' %}</a>
        <a href="{% url 'management_entity_image' entity.id %}" class="btn btn-primary btn-lg" target="_blank">{% trans 'upload image' %}</a>
        <a href="{% url 'management_entity_buy_link' entity.id %}" class="btn btn-primary btn-lg" target="_blank">{% trans 'add buy link' %}</a>
    </div>

    <div class="row">
        {% if update == 0 %}
            <div class="alert alert-success alert-dismissable" role="alert">
                <button type="button" class="close" data-dismiss="alert">
                    <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                </button>
                <strong>{% trans 'success' %}</strong>
                entity update success
            </div>
        {% endif %}
        {% if update == 1  %}
            <div class="alert alert-danger alert-dismissable" role="alert">
                <button type="button" class="close" data-dismiss="alert">
                    <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                </button>
                {% for k, v in forms.errors.items %}
                    <strong>{{ k }}</strong>
                    {{ v.as_text  }}
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="row">
        <div class="panel panel-default">
            <div class="panel-heading">{% trans 'buy links' %}</div>
            <ul class="list-group">
                {% for buy_link in entity.buy_links.all %}
                    <li class="list-group-item"><a href="{{ buy_link }}" target="_blank">{{ buy_link }}</a>
                        {% if not buy_link.default %}
                        <a class="pull-right" href="javascript:;">&nbsp;{% trans 'remove' %}</a>
                        {% endif %}
                        <span class="label label-primary pull-right">{{ buy_link.default }}</span>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="row">
        <form class="well form-horizontal" method="post">
            {% csrf_token %}
            <fieldset>
            {% for field in forms %}
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="{{ field.id_for_label }}">{{ field.label }}:</label>
                    <div class="col-sm-5">
                        {{ field }}
                    </div>
                </div>
            {% endfor %}
            </fieldset>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-5">
                    <button type="submit" class="btn btn-primary btn-lg">{% trans 'update' %}</button>
                </div>
            </div>
        </form>
    </div>

    <div class="row">
    <div class="table-responsive">
        <table class="table table-small-font table-hover table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>{% trans "creator" %}</th>
                    <th>{% trans 'content' %}</th>
                    <th>{% trans 'post time' %}</th>
                    <th>{% trans 'status' %}</th>
                    <th>{% trans 'operation' %}</th>
                </tr>
            </thead>
            <tbody>
                {% for note in entity.notes.all %}
                    <tr>
                        <td>{{ note.id }}</td>
                        <td>{{ note.user.profile.nickname }}</td>
                        <td>{{ note.note }}</td>
                        <td>{{ note.post_time|date:'Y-m-d H:i:s' }}</td>
                        <td>
                            {% if note.status == 1 %}
                                <span class="label label-info">{{ note.get_status_display }}</span>
                            {% else %}
                                <span class="label label-default">{{ note.get_status_display }}</span>
                            {% endif %}
                        </td>
                        <td><a class="btn btn-default" href="{% url 'management_note_edit' note.pk %}">{% trans 'edit' %}</a></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    </div>

    <div id="EntityNoteModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="EntityNoteModal" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content"></div>
        </div>
    </div>
{% endblock %}