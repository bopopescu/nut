{% extends 'management/management_base.html' %}
{% load i18n staticfiles %}


{% block css %}
    <link href="{% static 'summernote/summernote.css' %}" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/web/jquery.fileupload.css' %}">
{% endblock %}

{% block content %}
    <div class="row">
        <div class="thumbnail">
            <img class="img-responsive" id='article-cover' src="{{ article.cover_url }}" width="" height="">
        </div>
        <span class="btn btn-primary fileinput-button pull-right">
            <i class="fa fa-plus fa-lg"></i>&nbsp; <span>点击选择图片</span>
            <input id="fileupload" type="file" multiple="" name="cover_file" data-url="{% url 'management_article_cover_upload' article.pk %}">
        </span>
    </div>
    <div class="row">
        <form class="well form-horizontal" method="post">
        {% csrf_token %}
            <fieldset>
                {% for field in forms %}
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="{{ field.id_for_label }}">{{ field.label }}:</label>
                        <div class="col-sm-10">
                            {{ field }}
                        </div>
                    </div>
                {% endfor %}
            </fieldset>

            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
{#                    <div class="btn-group">#}
                        <button type="submit" class="btn btn-primary btn-lg">{% trans 'save' %}</button>
                        <a class="btn btn-default btn-lg" target="_blank" href="{% url 'management_article_preview' article.pk %}">{% trans 'preview' %}</a>
{#                    </div>#}
                </div>
            </div>
        </form>
    </div>
{% endblock %}

{% block js %}
    <script src="{% static 'summernote/summernote.min.js' %}"></script>
    <script>
    $(document).ready(function() {
        $('#summernote').summernote({
            height: 700,
            codemirror: { // codemirror options
{#                airMode: true,#}
                theme: 'spacelab'
            },
            focus: true,
            onImageUpload: function(file, editor, welEditable) {
                sendFile(file, editor, welEditable);
            },
            toolbar:[
                ['style',['style','bold','italic','underline','clear']],
{#                ['fontface',['fontname']],#}
{#                ['textsize',['fontsize']],#}
{#                ['color', ['color']],#}
                ['para', ['ul', 'ol']],
{#                ['height', ['height']],#}
                ['insert', ['picture','link','video',]]
            ]
        });
        function sendFile(file, editor, welEditable) {
            data = new FormData();
            data.append("file", file[0]);
            $.ajax({
                data: data,
                type: "POST",
                url: "{% url 'management_upload_image' %}",
                cache: false,
                contentType: false,
                processData: false,
                success: function(url) {
                    editor.insertImage(welEditable, url);
{#                    editor.insertImage(welEditable, url);#}
{#                    console.log(welEditable);#}
                }
            });
        }
    });
    </script>
{#{% block script %}#}
{#    <script src="https://blueimp.github.io/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"></script>#}
    <script src="{% static 'js/web/jquery.ui.widget.js' %}"></script>
    <script src="{% static 'js/web/jquery.iframe-transport.js' %}"></script>
    <script src="{% static 'js/web/jquery.fileupload.js' %}"></script>
{#    <script src="{% static 'js/web/account.js' %}"></script>#}
    <script>
$(function () {
    $('#fileupload').fileupload({
        dataType: 'json',
        disableImageResize: /Android(?!.*Chrome)|Opera/.test(window.navigator && navigator.userAgent),
        imageMaxWidth: 757,
        imageMaxHeight: 355,
        imageCrop: true, // Force cropped images
        done: function (e, data) {
            console.log(data.result.cover_url);
            $('#article-cover').attr('src', data.result.cover_url);
        }
    });
});
</script>
{#{% endblock %}#}
{% endblock %}